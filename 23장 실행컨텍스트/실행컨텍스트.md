# 실행 컨텍스트

## 23.1 소스코드의 타입

ECMAScript 사양은 소스코드를 4가지 타입으로 구분
-> 이 4가지 타입의 소스 코드는 실행 컨텍스트를 생성

소스코드의 타입에 따라서 실행 컨텍스트를 생성하는 과정과, 관리 내용이 다르다

이것을 공부하기에 앞서, 간단히 자바스크립트 엔진이 코드를 실행하는 방식에 대한 이해가 필요하다. JS엔진은 소스코드를 2개의 과정을 통해서 처리한다.

소스코드의 평가 -> 소스코드의 실행

**소스코드의 평가** 단계에서는 실행컨텍스트 생성 / 변수, 함수 등의 선언문만 먼저 실행하여 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록

**소스코드의 실행** 단계에서는 선언문을 제외한 소스코드가 순차적으로 실행(=== 런타임이 시작)

#### 1) 전역 코드

전역에 존재하는 소스코드. 전역에 정의된 함수/클래스 등의 내부 코드는 포함되지 않음

전역 코드는 전역 변수를 관리하기 위해 전역 스코프(-> 최상위 스코프)를 생성해야함. 그리고 전역 변수와(var로 선언된) 전역 함수를 전역 객체의 프로퍼티와 메서드로 바인딩하고 참조하기 위해서 전역 객체와 연결되어야 함

이를 위해서 전역 코드가 평가되면, 전역 실행 컨텍스트가 생성됨.

#### 2) 함수 코드

함수 내부에 존재하는 소스코드. 함수 내부에 중첩된 함수, 클래스 등의 내부 코드는 포함되지 않는다.()

_'내부는 포함되지 않는다'는 의미를 이해할 듯하다._

```javascript
function greetings() {
  function goodMorning() {
    alert("Good Morning!");
  }
}
```

여기서 함수 greetings 가 전역에서 선언된 함수라고 하면, 전역 코드의 일부인 greeting함수 선언문은 전역 코드를 평가하여 전역 실행 컨텍스트 포함되지만, 함수 goodMorning은 전역 실행 컨텍스트에 포함되지 않고, greetings 함수 실행 컨텍스트 내에서 처리됨...이라는 의미 아닐까?

무튼, 함수 코드는 지역 스코프 생성/지역 변수, 매개변수, arguments 객체를 관리해야함. 그리고 생성한 지역 스코프를 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결해야함
이를 위해서 함수 코드가 평가되면, 함수 실행 컨텍스트가 생성됨

> arguments 객체는 함수에 전달된 인수에 해당되는 Array 형태의 객체입니다.

> 스코프 체인이란?

#### 3. eval 코드

eval 코드는 strict mode에서 자신만의 독자적인 스코프를 생성. 이를 위해서, eval 코드가 평가되면 eval 실행 컨텍스트가 생성됨

> eval 코드란?

> strict mode란?

#### 4. 모듈 코드

모듈 코드는 모듈 별로 독립적인 모듈 스코프를 생성. 이를 위해서, 모듈 코드가 평가되면 모듈 실행 컨텍스트가 생성됨

_뭔지 100퍼센트 이해하지는 못하겠지만, 요약하자면 JS에서 소스코드는 크게 4가지 종류로 구분되고, JS엔진은 해당 소스코드에 대한 평가(평가 -> 실행의 2단계 중 평가 단계)를 통해 해당되는 실행 컨텍스트를 생성한다..라는 정도로 일단 이해하고 넘어가자._

---

## 23.2 소스코드의 평가와 실행

앞서 봤던 것처럼, 소스코드는 JS엔진에 의해서 우선 평가되고, 그 다음에 실행된다.

평가 단계에서 실행 컨텍스트가 생성되고, 실행 단계에서 소스코드 실행에 필요한 정보를 실행 컨텍스트가 관리하는 스코프에서 검색해서 얻는 식으로 동작함.

그리고 변수 값의 변경 등 소스코드를 실행한 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록됨.

_우선, 이런 식으로 동작하고, 어떤 순서로 코드가 실행된다 정도만 인지하고 넘어가자_

---

## 23.3 실행 컨텍스트의 역할

음음 그렇군..

우선, 특정 소스코드가 실행되기 위해서 필요한 요소들이 뭘까?

**1. 선언에 의해서 생성된 모든 식별자(변수, 함수, 클래스 등)를 스코프를 구분해서 등록하고, 상태변화를 지속적으로 관리할 수 있어야 한다.**
-> 음 그러니까, 개별 식별자 별로 어떤 스코프에서 생성되었는지 JS엔진이 알아야하고, 또 생성되어서 등록된 식별자의 상태가 변경되는지 여부를 계속 체크(및 반영 이겠지?) 할 수 있어야한다라는 의미 같음

**2. 스코프는 중첩 관계에 의해 스코프 체인을 형성해야 한다. 즉, 스코프 체인을 통해서 상위 스코프로 이동하며 식별자를 검색할 수 있어야 한다.**

**3. 현재 실행 중인 코드의 실행 순서를 변경할 수 있어야하며, 다시 되돌아갈 수도 있어야 한다.**

음 2번 3번은 아직 확실히 이해는 안되는거같음

무튼, 이 모든 것을 관리하는 것이 바로 실행 컨텍스트!! 실행컨텍스트는..

1. 소스코드 실행에 필요한 환경을 제공하며,
2. 코드 실행 결과를 실제로 관리하는 영역

이다.

식별자와 스코프는 **렉시컬 환경**으로 관리 && 코드 실행 순서는 **실행 컨텍스트 스택**으로 관리

---

## 추가적으로 공부해야하는 부분

- arguments 객체
- 자바스크립트 엔진/ 동작 방식
